<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>Asynchronous in JS - TyrangYang_Blog</title><meta name=Description content="This is my cool site"><meta property="og:url" content="https://tyrangyang.github.io/TyrangYang_blog/js-asynchronous/">
<meta property="og:site_name" content="TyrangYang_Blog"><meta property="og:title" content="Asynchronous in JS"><meta property="og:description" content="Synchronous & asynchronous Function run synchronously means code is running as same as your writing.
But in real situation, some code may need time to running (like fetch). If synchronously run all code, program will be block and wait this time consuming part finish and continue.
In the most of the time, You code logic need wait to continue but you don’t want to block all progress. Maybe UI rendering or some other total unrelated code. Unfortunately, JS is single thread langrage and concurrency is not exist. Therefore, you need some technique to some part running asynchronously,"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-07-20T00:00:00+00:00"><meta property="article:modified_time" content="2025-07-20T00:00:00+00:00"><meta property="article:tag" content="Javascript"><meta property="article:tag" content="Nodejs"><meta property="article:tag" content="Promise"><meta property="article:tag" content="Generator"><meta property="article:tag" content="Thunk"><meta name=twitter:card content="summary"><meta name=twitter:title content="Asynchronous in JS"><meta name=twitter:description content="Synchronous & asynchronous Function run synchronously means code is running as same as your writing.
But in real situation, some code may need time to running (like fetch). If synchronously run all code, program will be block and wait this time consuming part finish and continue.
In the most of the time, You code logic need wait to continue but you don’t want to block all progress. Maybe UI rendering or some other total unrelated code. Unfortunately, JS is single thread langrage and concurrency is not exist. Therefore, you need some technique to some part running asynchronously,"><meta name=twitter:site content="@TyrangYang"><meta name=application-name content="My cool site"><meta name=apple-mobile-web-app-title content="My cool site"><meta name=referrer content="no-referrer"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=https://tyrangyang.github.io/TyrangYang_blog/favicon.ico><link rel=icon type=image/png sizes=32x32 href=https://tyrangyang.github.io/TyrangYang_blog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://tyrangyang.github.io/TyrangYang_blog/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=https://tyrangyang.github.io/TyrangYang_blog/apple-touch-icon.png><link rel=mask-icon href=https://tyrangyang.github.io/TyrangYang_blog/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=https://tyrangyang.github.io/TyrangYang_blog/site.webmanifest><link rel=canonical href=https://tyrangyang.github.io/TyrangYang_blog/js-asynchronous/><link rel=prev href=https://tyrangyang.github.io/TyrangYang_blog/html-trick/><link rel=stylesheet href=https://tyrangyang.github.io/TyrangYang_blog/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Asynchronous in JS","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/tyrangyang.github.io\/TyrangYang_blog\/js-asynchronous\/"},"genre":"posts","keywords":"javascript, nodejs, promise, generator, thunk","wordcount":1277,"url":"https:\/\/tyrangyang.github.io\/TyrangYang_blog\/js-asynchronous\/","datePublished":"2025-07-20T00:00:00+00:00","dateModified":"2025-07-20T00:00:00+00:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Haolin Yang"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=https://tyrangyang.github.io/TyrangYang_blog/ title=TyrangYang_Blog>TyrangYang_Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=https://tyrangyang.github.io/TyrangYang_blog/posts/><i class='fas fa-book-open'></i> Posts </a><a class=menu-item href=https://tyrangyang.github.io/TyrangYang_blog/tags/><i class='fas fa-tags'></i> Tags </a><a class=menu-item href=https://tyrangyang.github.io/TyrangYang_blog/categories/><i class='fab fa-buffer'></i> Categories </a><a class=menu-item href=https://github.com/TyrangYang/TyrangYang_blog title="Blog github" rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw fa-fw'></i> </a><a class=menu-item href=https://tyrangyang.github.io/ title="home page" rel="noopener noreffer" target=_blank><i class="fas fa-home"></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i>
</span></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=https://tyrangyang.github.io/TyrangYang_blog/ title=TyrangYang_Blog>TyrangYang_Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i>
</a><span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=https://tyrangyang.github.io/TyrangYang_blog/posts/ title><i class='fas fa-book-open'></i> Posts</a><a class=menu-item href=https://tyrangyang.github.io/TyrangYang_blog/tags/ title><i class='fas fa-tags'></i> Tags</a><a class=menu-item href=https://tyrangyang.github.io/TyrangYang_blog/categories/ title><i class='fab fa-buffer'></i> Categories</a><a class=menu-item href=https://github.com/TyrangYang/TyrangYang_blog title="Blog github" rel="noopener noreffer" target=_blank><i class='fab fa-github fa-fw fa-fw'></i> </a><a class=menu-item href=https://tyrangyang.github.io/ title="home page" rel="noopener noreffer" target=_blank><i class="fas fa-home"></i> </a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class="toc-content always-active" id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Asynchronous in JS</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://tyrangyang.github.io/TyrangYang_blog/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Haolin Yang</a></span>&nbsp;<span class=post-category>included in <a href=https://tyrangyang.github.io/TyrangYang_blog/categories/posts/><i class="far fa-folder fa-fw" aria-hidden=true></i>Posts</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2025-07-20>2025-07-20</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;1277 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;6 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#synchronous--asynchronous>Synchronous & asynchronous</a><ul><li><a href=#js-event-loop--call-stack--task-queue>Js event loop | Call stack | task queue</a></li></ul></li><li><a href=#callback>Callback</a></li><li><a href=#generator>generator</a></li><li><a href=#promise>Promise</a><ul><li><a href=#other-useful-feature-in-promise>Other useful feature in promise</a></li></ul></li><li><a href=#promise--generator>promise + generator</a></li><li><a href=#async--await>Async & Await</a><ul><li><a href=#prevent-trycatch-hell>Prevent tryCatch hell</a></li></ul></li></ul></nav></div></div><div class=content id=content><h2 id=synchronous--asynchronous>Synchronous & asynchronous</h2><p>Function run synchronously means code is running as same as your writing.</p><p>But in real situation, some code may need time to running (like fetch). If synchronously run all code, program will be block and wait this time consuming part finish and continue.</p><p>In the most of the time, You code logic need wait to continue but you don&rsquo;t want to block all progress. Maybe UI rendering or some other total unrelated code. Unfortunately, JS is single thread langrage and concurrency is not exist. Therefore, you need some technique to some part running asynchronously,</p><h3 id=js-event-loop--call-stack--task-queue>Js event loop | Call stack | task queue</h3><p>This <a href="http://latentflip.com/loupe/?code=JC5vbignYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24gb25DbGljaygpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gdGltZXIoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1lvdSBjbGlja2VkIHRoZSBidXR0b24hJyk7ICAgIAogICAgfSwgMjAwMCk7Cn0pOwoKY29uc29sZS5sb2coIkhpISIpOwoKc2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkgewogICAgY29uc29sZS5sb2coIkNsaWNrIHRoZSBidXR0b24hIik7Cn0sIDUwMDApOwoKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUuIik7!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D" target=_blank rel="noopener noreffer"><strong>website</strong></a> shows how js engine running with single thread to handle concurrency</p><p>Task queue will be the key for simulating asynchronous. The asynchronous part will leave the queue first and back after it is ready.</p><p>Async action will be know by js engine (like setTimeout, XMLrequest, fetch api). But need to handle what will be do next when back to task queue</p><h2 id=callback>Callback</h2><p>Technically Callback function is not a method to achieve async. It just a function as a parameter. And Callback function include what you need to do next. That&rsquo;s it.</p><blockquote><p>One concept need mention. The callback function include logic. Also could called as Thunk.</p></blockquote><p>Think about a scenario: step1 -> step2 -> step3. Each step need previous one finished.</p><p>Code will be like</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>step1</span><span class=p>(</span><span class=nx>param1</span><span class=p>,</span> <span class=nx>cb</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>param1</span><span class=p>);</span> <span class=c1>// async part. need some time
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>cb</span><span class=p>(</span><span class=nx>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>step2</span><span class=p>(</span><span class=nx>param2</span><span class=p>,</span> <span class=nx>cb</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>param2</span><span class=p>);</span> <span class=c1>// async part. need some time
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>cb</span><span class=p>(</span><span class=nx>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>step3</span><span class=p>(</span><span class=nx>param3</span><span class=p>,</span> <span class=nx>cb</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=nx>fetch</span><span class=p>(</span><span class=nx>param3</span><span class=p>);</span> <span class=c1>// async part. need some time
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>cb</span><span class=p>(</span><span class=nx>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>step1</span><span class=p>(...</span><span class=nx>arg1</span><span class=p>,</span> <span class=p>(</span><span class=nx>res1</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>step2</span><span class=p>(</span><span class=nx>res1</span><span class=p>,</span> <span class=p>(</span><span class=nx>res2</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>step3</span><span class=p>(</span><span class=nx>res2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>});</span></span></span></code></pre></div></div><p>Code will run async. During waiting time, some other thing could handle. But code will be come hard to read. 3 steps maybe readable. What about 10? All of nest together?</p><p>Therefore, developer want to make code more readable. The ultimate solution will like code is writing synchronously. But js engine will automatically know this part need wait.</p><p>like</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>const</span> <span class=nx>res1</span> <span class=o>=</span> <span class=nx>step1</span><span class=p>(...</span><span class=nx>arg1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>res2</span> <span class=o>=</span> <span class=nx>step2</span><span class=p>(</span><span class=nx>res1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>res3</span> <span class=o>=</span> <span class=nx>step3</span><span class=p>(</span><span class=nx>res2</span><span class=p>);</span></span></span></code></pre></div></div><h2 id=generator>generator</h2><p>See this code about generator.</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span><span class=o>*</span> <span class=nx>gen</span><span class=p>(</span><span class=nx>init</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>genRes1</span> <span class=o>=</span> <span class=k>yield</span> <span class=nx>init</span> <span class=o>+</span> <span class=mi>2</span><span class=p>;</span> <span class=c1>// now just simple sync but it could be a async fun here
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>let</span> <span class=nx>genRes2</span> <span class=o>=</span> <span class=k>yield</span> <span class=nx>genRes1</span> <span class=o>+</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>[</span><span class=nx>genRes1</span><span class=p>,</span> <span class=nx>genRes2</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>g</span> <span class=o>=</span> <span class=nx>gen</span><span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>res1</span> <span class=o>=</span> <span class=nx>g</span><span class=p>.</span><span class=nx>next</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>res2</span> <span class=o>=</span> <span class=nx>g</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=nx>res1</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span> <span class=c1>// res1.value goes to genRes1
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>const</span> <span class=nx>res3</span> <span class=o>=</span> <span class=nx>g</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=nx>res2</span><span class=p>.</span><span class=nx>value</span><span class=p>);</span> <span class=c1>// res2.value goes to genRes2
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>res1</span><span class=p>);</span> <span class=c1>// { value: 3, done: false }
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>res2</span><span class=p>);</span> <span class=c1>// { value: 6, done: false }
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>res3</span><span class=p>);</span> <span class=c1>// { value: [ 3, 6 ], done: true }
</span></span></span></code></pre></div></div><p>When runs to yield keyword. Function will stop and wait. When you trigger next(), it will continuous logic after yield.</p><p>if run next(val), val will be previous yield result.</p><p>Now you can see gen(). Is it looks like a synchronously? <strong>More importantly</strong>, Each step in gen() be stop and resume manually. Is it looks like asynchronous concept?</p><p>If we run gen() and let generator resume by itself. Does we achieve the goal of writing synchronous code and allow code jump outside function (async)?</p><p>Since the next() function have pattern. We can run recursive function to let it run automatically.</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// same generator
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>function</span><span class=o>*</span> <span class=nx>gen</span><span class=p>(</span><span class=nx>init</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>genRes1</span> <span class=o>=</span> <span class=k>yield</span> <span class=nx>init</span> <span class=o>+</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>genRes1</span><span class=p>);</span> <span class=c1>// 3
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>let</span> <span class=nx>genRes2</span> <span class=o>=</span> <span class=k>yield</span> <span class=nx>genRes1</span> <span class=o>+</span> <span class=mi>3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>genRes2</span><span class=p>);</span> <span class=c1>// 6
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>return</span> <span class=p>[</span><span class=nx>genRes1</span><span class=p>,</span> <span class=nx>genRes2</span><span class=p>];</span> <span class=c1>// [3, 6]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>run</span> <span class=o>=</span> <span class=p>(</span><span class=nx>gen</span><span class=p>,</span> <span class=nx>init</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>g</span> <span class=o>=</span> <span class=nx>gen</span><span class=p>(</span><span class=nx>init</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>resList</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>recursive</span> <span class=o>=</span> <span class=p>(</span><span class=nx>prevData</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>res</span> <span class=o>=</span> <span class=nx>g</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=nx>prevData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>res</span><span class=p>.</span><span class=nx>done</span><span class=p>)</span> <span class=k>return</span> <span class=nx>resList</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>curData</span> <span class=o>=</span> <span class=nx>res</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>resList</span><span class=p>.</span><span class=nx>push</span><span class=p>(</span><span class=nx>curData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nx>recursive</span><span class=p>(</span><span class=nx>curData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>recursive</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>runner</span><span class=p>(</span><span class=nx>gen</span><span class=p>);</span></span></span></code></pre></div></div><p>I can give one async example</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>thunkifyPrintCb</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>print</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>callback</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>callback</span><span class=p>(</span><span class=nx>print</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>2000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>thunkGen</span> <span class=o>=</span> <span class=kd>function</span><span class=o>*</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>step1</span> <span class=o>=</span> <span class=k>yield</span> <span class=nx>thunkifyPrintCb</span><span class=p>(</span><span class=s1>&#39;/etc/fstab&#39;</span><span class=p>);</span> <span class=c1>// step1 is result. yield thunkifyPrintCb(&#39;/etc/fstab&#39;) is a thunk function
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;step1&#39;</span><span class=p>,</span> <span class=nx>step1</span><span class=p>);</span> <span class=c1>// print step1 /etc/fstab after 2s
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=kd>let</span> <span class=nx>step2</span> <span class=o>=</span> <span class=k>yield</span> <span class=nx>thunkifyPrintCb</span><span class=p>(</span><span class=s1>&#39;/etc/shells&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;step2&#39;</span><span class=p>,</span> <span class=nx>step2</span><span class=p>);</span> <span class=c1>// print step2 /etc/shells after 2s
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>runner</span><span class=p>(</span><span class=nx>generator</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>gen</span> <span class=o>=</span> <span class=nx>generator</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nx>recursive</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>result</span> <span class=o>=</span> <span class=nx>gen</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>done</span><span class=p>)</span> <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>result</span><span class=p>.</span><span class=nx>value</span><span class=p>((</span><span class=nx>res</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>recursive</span><span class=p>(</span><span class=nx>res</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>recursive</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>runner</span><span class=p>(</span><span class=nx>thunkGen</span><span class=p>);</span></span></span></code></pre></div></div><p>thunkGen() will be that async function.</p><h2 id=promise>Promise</h2><p>Promise is another technique to deal with async. It been encapsulated in an object. The purpose of Promise is to give some extra feature to handle async function.</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>function</span> <span class=nx>step1</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>res</span><span class=p>,</span> <span class=nx>rej</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;step1 done&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>(</span><span class=s1>&#39;res1&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>2000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>step2</span><span class=p>(</span><span class=nx>prevResult</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>res</span><span class=p>,</span> <span class=nx>rej</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;step2 done, got:&#39;</span><span class=p>,</span> <span class=nx>prevResult</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>(</span><span class=s1>&#39;res2&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>2000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>step3</span><span class=p>(</span><span class=nx>prevResult</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>res</span><span class=p>,</span> <span class=nx>rej</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;step3 done, got:&#39;</span><span class=p>,</span> <span class=nx>prevResult</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nx>res</span><span class=p>(</span><span class=s1>&#39;res3&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>2000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// step by step
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>step1</span><span class=p>()</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>res1</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>step2</span><span class=p>(</span><span class=nx>res1</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>res2</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>step3</span><span class=p>(</span><span class=nx>res2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>  <span class=p>.</span><span class=nx>then</span><span class=p>((</span><span class=nx>res3</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;All done:&#39;</span><span class=p>,</span> <span class=nx>res3</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// concurrency
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>([</span><span class=nx>step1</span><span class=p>(</span><span class=s1>&#39;1&#39;</span><span class=p>),</span> <span class=nx>step2</span><span class=p>(</span><span class=s1>&#39;2&#39;</span><span class=p>),</span> <span class=nx>step3</span><span class=p>(</span><span class=s1>&#39;3&#39;</span><span class=p>)]);</span></span></span></code></pre></div></div><p>If you see the code for step by step. It is still have nested structure. &ldquo;Then hell&rdquo; merely better than &ldquo;callback hell&rdquo;. more feature is the key</p><h3 id=other-useful-feature-in-promise>Other useful feature in promise</h3><p>Promise can mimic concurrency. Like Promise.all([list of promise])</p><p>Fire async all together. Get them all or get the fast one</p><p>all() will pass val contained all promise return val after all promise is finish</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>promise1</span> <span class=o>=</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;First&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>promise2</span> <span class=o>=</span> <span class=s1>&#39;Second&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>promise3</span> <span class=o>=</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>((</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>resolve</span><span class=p>(</span><span class=s1>&#39;Goodbye&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=mi>1000</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>});</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>Promise</span><span class=p>.</span><span class=nx>all</span><span class=p>([</span><span class=nx>promise1</span><span class=p>,</span> <span class=nx>promise2</span><span class=p>,</span> <span class=nx>promise3</span><span class=p>]).</span><span class=nx>then</span><span class=p>((</span><span class=nx>val</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>val</span><span class=p>));</span> <span class=c1>// go to next only all fulfilled
</span></span></span><span class=line><span class=cl><span class=c1>// [ &#39;First&#39;, &#39;Second&#39;, &#39;Goodbye&#39; ] (after one second)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nb>Promise</span><span class=p>.</span><span class=nx>allSettled</span><span class=p>([</span><span class=nx>promise1</span><span class=p>,</span> <span class=nx>promise2</span><span class=p>,</span> <span class=nx>promise3</span><span class=p>]).</span><span class=nx>then</span><span class=p>((</span><span class=nx>val</span><span class=p>)</span> <span class=p>=&gt;</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>val</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>);</span> <span class=c1>// get all status
</span></span></span><span class=line><span class=cl><span class=c1>// [
</span></span></span><span class=line><span class=cl><span class=c1>//   { status: &#39;fulfilled&#39;, value: &#39;First&#39; },
</span></span></span><span class=line><span class=cl><span class=c1>//   { status: &#39;fulfilled&#39;, reason: &#39;Second&#39; },
</span></span></span><span class=line><span class=cl><span class=c1>//   { status: &#39;fulfilled&#39;, value: &#39;Goodbye&#39; }
</span></span></span><span class=line><span class=cl><span class=c1>// ]
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nb>Promise</span><span class=p>.</span><span class=nx>race</span><span class=p>([</span><span class=nx>promise1</span><span class=p>,</span> <span class=nx>promise2</span><span class=p>,</span> <span class=nx>promise3</span><span class=p>]).</span><span class=nx>then</span><span class=p>((</span><span class=nx>val</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>val</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>// as soon as one of the promises in an iterable fulfills or rejects
</span></span></span><span class=line><span class=cl><span class=c1>// probably: &#39;Second&#39; goes fast
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nb>Promise</span><span class=p>.</span><span class=nx>any</span><span class=p>([</span><span class=nx>promise1</span><span class=p>,</span> <span class=nx>promise2</span><span class=p>,</span> <span class=nx>promise3</span><span class=p>]).</span><span class=nx>then</span><span class=p>((</span><span class=nx>val</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>val</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>// only the first fulfilled. Ignore rejected
</span></span></span></code></pre></div></div><h2 id=promise--generator>promise + generator</h2><p>Promise have feature. Generator handle sync code writing. Why not put them together.</p><p>Yes we could</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kd>let</span> <span class=nx>asyncPrintPromise</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>(</span><span class=nx>print</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=k>new</span> <span class=nb>Promise</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>resolve</span><span class=p>,</span> <span class=nx>reject</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setTimeout</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>resolve</span><span class=p>(</span><span class=nx>print</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span> <span class=mi>2000</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>});</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>let</span> <span class=nx>promiseGen</span> <span class=o>=</span> <span class=kd>function</span><span class=o>*</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>f1</span> <span class=o>=</span> <span class=k>yield</span> <span class=nx>asyncPrintPromise</span><span class=p>(</span><span class=s1>&#39;/etc/fstab&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;f1&#39;</span><span class=p>,</span> <span class=nx>f1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=nx>f2</span> <span class=o>=</span> <span class=k>yield</span> <span class=nx>asyncPrintPromise</span><span class=p>(</span><span class=s1>&#39;/etc/shells&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;f2&#39;</span><span class=p>,</span> <span class=nx>f2</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>runner</span><span class=p>(</span><span class=nx>promiseGen</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>g</span> <span class=o>=</span> <span class=nx>promiseGen</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>function</span> <span class=nx>recursive</span><span class=p>(</span><span class=nx>data</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>var</span> <span class=nx>result</span> <span class=o>=</span> <span class=nx>g</span><span class=p>.</span><span class=nx>next</span><span class=p>(</span><span class=nx>data</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>result</span><span class=p>.</span><span class=nx>done</span><span class=p>)</span> <span class=k>return</span> <span class=nx>result</span><span class=p>.</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=nx>result</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span> <span class=p>(</span><span class=nx>promiseData</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>recursive</span><span class=p>(</span><span class=nx>promiseData</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>});</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>recursive</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>runner</span><span class=p>(</span><span class=nx>promiseGen</span><span class=p>);</span></span></span></code></pre></div></div><h2 id=async--await>Async & Await</h2><p>The behavior of async/await is similar to combining generators and promises. You basically can consider like a syntactic surger.</p><p>async => runner + *
await => yield</p><p>Another example from promise:</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>async</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>step1</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>step2</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=kr>await</span> <span class=nx>step3</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>main</span><span class=p>();</span></span></span></code></pre></div></div><h3 id=prevent-trycatch-hell>Prevent tryCatch hell</h3><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>getDataTryCatchHell</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>a</span><span class=p>,</span> <span class=nx>b</span><span class=p>,</span> <span class=nx>c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>a</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>handleErr</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>b</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>handleErr</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>c</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nx>handleErr</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>Usually just append <code>.catch()</code> function behind the await function,</p><div class="code-block code-line-numbers open" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>getData</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>a</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(...).</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=p>=&gt;</span> <span class=nx>handleErr</span><span class=p>(</span><span class=nx>err</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>b</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(...).</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=p>=&gt;</span> <span class=nx>handleErr</span><span class=p>(</span><span class=nx>err</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=kd>let</span> <span class=nx>c</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>(...).</span><span class=k>catch</span><span class=p>(</span><span class=nx>err</span><span class=p>=&gt;</span> <span class=nx>handleErr</span><span class=p>(</span><span class=nx>err</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div><p>A better way is creating a function return data and error.</p><div class="code-block code-line-numbers" style="counter-reset:code-block 0"><div class="code-header language-js"><span class=code-title><i class="arrow fas fa-angle-right fa-fw" aria-hidden=true></i></span>
<span class=ellipses><i class="fas fa-ellipsis-h fa-fw" aria-hidden=true></i></span>
<span class=copy title="Copy to clipboard"><i class="far fa-copy fa-fw" aria-hidden=true></i></span></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>awesome</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>try</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kr>const</span> <span class=nx>data</span> <span class=o>=</span> <span class=kr>await</span> <span class=nx>fetch</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=nx>data</span><span class=p>,</span> <span class=kc>null</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span> <span class=k>catch</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>[</span><span class=kc>null</span><span class=p>,</span> <span class=nx>err</span><span class=p>];</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>async</span> <span class=kd>function</span> <span class=nx>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>let</span> <span class=p>[</span><span class=nx>data</span><span class=p>,</span> <span class=nx>err</span><span class=p>]</span> <span class=o>=</span> <span class=nx>awesome</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=nx>err</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=nx>err</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span></span></span></code></pre></div></div></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2025-07-20</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=https://tyrangyang.github.io/TyrangYang_blog/js-asynchronous/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on X" data-sharer=x data-url=https://tyrangyang.github.io/TyrangYang_blog/js-asynchronous/ data-title="Asynchronous in JS" data-via=@TyrangYang data-hashtags=javascript,nodejs,promise,generator,thunk><i class="fab fa-x-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Threads" data-sharer=threads data-url=https://tyrangyang.github.io/TyrangYang_blog/js-asynchronous/ data-title="Asynchronous in JS"><i class="fab fa-threads fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://tyrangyang.github.io/TyrangYang_blog/js-asynchronous/ data-hashtag=javascript><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=https://tyrangyang.github.io/TyrangYang_blog/js-asynchronous/ data-title="Asynchronous in JS"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://tyrangyang.github.io/TyrangYang_blog/js-asynchronous/ data-title="Asynchronous in JS"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@14.9.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=https://tyrangyang.github.io/TyrangYang_blog/js-asynchronous/ data-title="Asynchronous in JS"><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Diaspora" data-sharer=diaspora data-url=https://tyrangyang.github.io/TyrangYang_blog/js-asynchronous/ data-title="Asynchronous in JS" data-description><i class="fab fa-diaspora fa-fw" aria-hidden=true></i></a><a href="https://t.me/share/url?url=https%3a%2f%2ftyrangyang.github.io%2fTyrangYang_blog%2fjs-asynchronous%2f&amp;text=Asynchronous%20in%20JS" target=_blank title="Share on Telegram"><i class="fab fa-telegram fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=https://tyrangyang.github.io/TyrangYang_blog/tags/javascript/>Javascript</a>,&nbsp;<a href=https://tyrangyang.github.io/TyrangYang_blog/tags/nodejs/>Nodejs</a>,&nbsp;<a href=https://tyrangyang.github.io/TyrangYang_blog/tags/promise/>Promise</a>,&nbsp;<a href=https://tyrangyang.github.io/TyrangYang_blog/tags/generator/>Generator</a>,&nbsp;<a href=https://tyrangyang.github.io/TyrangYang_blog/tags/thunk/>Thunk</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=https://tyrangyang.github.io/TyrangYang_blog/>Home</a></span></section></div><div class=post-nav><a href=https://tyrangyang.github.io/TyrangYang_blog/html-trick/ class=prev rel=prev title="HTML/Document Trick"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>HTML/Document Trick</a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.145.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.3.1-DEV"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2022 - 2025</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://tyrangyang.github.io/TyrangYang_blog/ target=_blank>xxxx</a></span>&nbsp;|&nbsp;<span class=license><a rel=license style=position:relative;top:3px href=http://creativecommons.org/licenses/by-nc-nd/4.0/><img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png></a><br>This work is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-nc-nd/4.0/>Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i></a></div><div id=fixed-buttons-hidden><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><script src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script src=https://cdn.jsdelivr.net/npm/algoliasearch@5.20.2/dist/lite/builds/browser.umd.min.js></script><script src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.2/sharer.min.js></script><script>window.config={comment:{},search:{algoliaAppID:"QXEV52XWDS",algoliaIndex:"blog",algoliaSearchKey:"db56d05ebbeed337adca1ef261004dcc",highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"algolia"}}</script><script src=https://tyrangyang.github.io/TyrangYang_blog/js/theme.min.js></script></body></html>